"use strict";(self["webpackChunkvue_workbase_app"]=self["webpackChunkvue_workbase_app"]||[]).push([[558],{43678:function(e,l,a){a.d(l,{FO:function(){return t},Jp:function(){return s},Ue:function(){return i},Vx:function(){return u},nY:function(){return o},ts:function(){return c}});var n=a(4648),r=a(38042);const t=(e,l={},a)=>r.Z.get(`crazy/freelancer/v1.0.1/orders/${e}`,(0,n.Z)({params:l},a)),i=(e={services:services},l={})=>r.Z.post("crazy/freelancer/v1.0.1/orders",e,l),u=(e,l={services:services,name:name,address:address,lat:lat,lng:lng,is_online:is_online,at_customer:at_customer,at_executor:at_executor},a={})=>r.Z.post(`crazy/freelancer/v1.0.1/orders/${e}`,l,a),s=(e,l,a)=>r.Z["delete"](`crazy/freelancer/v1.0.1/orders/${e}`,(0,n.Z)({params:l},a)),o=(e,l={},a={})=>r.Z.post(`crazy/freelancer/v1.0.1/orders/${e}/publish`,l,a),c=(e,l={},a={})=>r.Z.post(`crazy/freelancer/v1.0.1/orders/${e}/replies`,l,a)},79166:function(e,l,a){a.d(l,{Ql:function(){return i},U2:function(){return t},Ue:function(){return u}});var n=a(4648),r=a(38042);const t=(e={with:[],category:null,page:1,perPage:10},l={})=>r.Z.get("crazy/freelancer/v1.0.1/services",(0,n.Z)({params:e},l)),i=(e,l={with:[],count:[]},a={})=>r.Z.get(`crazy/freelancer/v1.0.1/services/${e}`,(0,n.Z)({params:l},a)),u=(e={name:"",parent:null,category:null},l={})=>r.Z.post("crazy/freelancer/v1.0.1/services",e,l)},1875:function(e,l,a){a.d(l,{Z:function(){return o}});var n=a(59063),r=a(2262),t=a(66252);const i=(0,r.qj)({id:null,name:null,slug:null,excerpt:null,description:null,priority_services:[],services:[],image:null}),u=(0,r.iH)(!1),s=(0,r.iH)(null);function o(){const e=(0,t.Fl)((()=>!!i.slug)),l=async(e,l={with:[]})=>(Object.assign(i,{id:null,name:null,slug:null,excerpt:null,description:null,priority_services:[],services:[],image:null}),u.value=!0,s.value=(0,n.Q)(e,l).then((e=>e.data)).then((e=>(Object.assign(i,null===e||void 0===e?void 0:e.category),(0,r.OT)(i)))).finally((()=>u.value=!1)),await s.value),a=async(a,n={with:[]})=>i.slug!=a&&i.id!=a?await l(a,n):e.value?(0,r.OT)(i):s.value?await s.value:await l(a,n);return{category:(0,r.OT)(i),isLoading:(0,r.OT)(u),isLoaded:(0,r.OT)(e),promise:(0,r.OT)(s),onGetWhenNotLoaded:a,onGet:l}}},97402:function(e,l,a){a.d(l,{A:function(){return y},ls:function(){return g},rJ:function(){return c}});var n=a(43678),r=a(66309),t=a(2262),i=a(66252);const u=(0,r._aR)("drafted",{}),s=(0,t.iH)(!1),o=(0,t.iH)(null);function c(e){const l=(0,t.iH)(!!u.value[e]),a=(a={services:[],category:null},r={})=>(s.value=!0,o.value=(0,n.Ue)(a).then((e=>e.data)).then((a=>(l.value=!0,u.value[e]=a.order,(0,t.OT)((0,i.Fl)((()=>u.value[e])))))).finally((()=>s.value=!1)),o.value);return{onCreate:a,isCreated:(0,t.OT)(l),isCreating:(0,t.OT)(s),promise:(0,t.OT)(o),draftedOrders:(0,t.OT)(u),currentDraftedOrder:(0,t.OT)((0,i.Fl)((()=>u.value[e])))}}const d=(0,t.iH)(!1),v=(0,t.iH)(!1),p=(0,t.iH)(null);function g(e){const l=(l={services:[],name:null,description:null,price:null,price_unit:null,price_from:null,price_up_to:null,is_ranged_price:null,started_at:null,ended_at:null,is_online:null,at_executor:null,at_customer:null,exit_locations:null,address:null,lat:null,lng:null})=>{var a;return d.value=!0,v.value=!1,p.value=(0,n.Vx)(null===(a=u.value[e])||void 0===a?void 0:a.id,l).then((e=>e.data)).then((l=>{u.value[e]=l.order,v.value=!0})).finally((()=>d.value=!1)),p.value};return{isUpdated:(0,t.OT)(v),isUpdating:(0,t.OT)(d),promise:(0,t.OT)(p),onUpdate:l,draftedOrders:(0,t.OT)(u),currentDraftedOrder:(0,t.OT)((0,i.Fl)((()=>u.value[e])))}}const f=(0,t.iH)(!1),m=(0,t.iH)(null);function y(e){const l=(0,t.iH)(!1),a=()=>{var a;return f.value=!0,m.value=(0,n.nY)(null===(a=u.value[e])||void 0===a?void 0:a.id).then((e=>e.data)).then((e=>null===e||void 0===e?void 0:e.order)).then((a=>(l.value=!0,delete u.value[e],a))).finally((()=>f.value=!1))};return{isPublishing:(0,t.OT)(f),isPublished:(0,t.OT)(l),promise:(0,t.OT)(m),onPublish:a,draftedOrders:(0,t.OT)(u),currentDraftedOrder:(0,t.OT)((0,i.Fl)((()=>u.value[e])))}}},20586:function(e,l,a){a.d(l,{Z:function(){return c}});var n=a(79166),r=a(2262);const t=(0,r.iH)([]),i=(0,r.iH)(!1),u=(0,r.iH)(null),s=(0,r.iH)(!1),o=(0,r.iH)(null);function c(e={page:1,perPage:10,search:null,category:null,parent:null,nested:null}){const l=async(l={page:1,perPage:10,search:null,category:null,parent:null,nested:null})=>{i.value=!0;const a={};return Object.assign(a,e,l),o.value=new AbortController,await new Promise((e=>setTimeout(e,2e3))),u.value=(0,n.U2)(a,{signal:o.value.signal}).then((e=>e.data)).then((e=>(t.value=e.collection,s.value=!0,(0,r.OT)(t)))).finally((()=>{i.value=!1})),await u.value},a=()=>{o.value&&o.value.abort()},c=()=>{t.value=[],s.value=!1};return{isLoading:(0,r.OT)(i),isLoaded:(0,r.OT)(s),services:(0,r.OT)(t),promise:(0,r.OT)(u),onGet:l,cancel:a,clear:c}}},69722:function(e,l,a){a.d(l,{Z:function(){return t}});var n=a(79166),r=a(2262);function t(){const e=(0,r.iH)(),l=(0,r.iH)(!1),a=(0,r.iH)(!1),t=(0,r.iH)(null),i=async(i,u={with:[],count:[]},s={})=>(l.value=!0,t.value=(0,n.Ql)(i,u,s).then((e=>e.data)).then((l=>(e.value=l.service,a.value=!0,(0,r.OT)(e)))).finally((()=>l.value=!1)),await t.value);return{service:(0,r.OT)(e),isLoading:(0,r.OT)(l),isLoaded:(0,r.OT)(a),promise:(0,r.OT)(t),onGet:i}}},59228:function(e,l,a){a.d(l,{Z:function(){return g}});var n=a(66252),r=a(49963),t=a(22201);const i=["onSubmit"],u={class:"p-4"},s={class:"px-4 flex-1 min-h-[18rem]"},o={class:"p-4 sticky bottom-0 bg-white flex justify-between z-40 drop-shadow-lg"},c=(0,n.Uk)(" отмена "),d=(0,n.Uk)(" продолжить ");var v={__name:"base-form",emits:["onSubmit"],setup(e,{emit:l}){const a=(0,t.tv)(),v=e=>l("onSubmit",e),p=()=>{a.back()};return(e,l)=>{const a=(0,n.up)("c-button");return(0,n.wg)(),(0,n.iD)("form",{class:"flex flex-col relative w-full min-h-full rounded-lg bg-white shadow shadow-primary/25 overflow-clip",onSubmit:(0,r.iM)(v,["prevent"])},[(0,n._)("div",u,[(0,n.WI)(e.$slots,"header")]),(0,n._)("div",s,[(0,n.WI)(e.$slots,"default")]),(0,n._)("div",o,[(0,n.WI)(e.$slots,"footer",{},(()=>[(0,n.Wm)(a,{scheme:"secondary",type:"button",onClick:p},{default:(0,n.w5)((()=>[c])),_:1}),(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[d])),_:1})]))])],40,i)}}};const p=v;var g=p},60989:function(e,l,a){a.r(l),a.d(l,{default:function(){return z}});var n=a(66252),r=a(2262),t=a(3577),i=a(59228),u=a(1875),s=a(97402),o=a(20586),c=a(69722),d=a(54028),v=a(62587),p=a(91296),g=a.n(p),f=a(22201);const m={key:0,class:"pt-1.5 pb-0.5"},y=(0,n._)("div",{class:"h-7 w-96 bg-primary/10 rounded-lg animate-pulse"},null,-1),w=[y],h={key:2,class:"pt-1.5 pb-0.5"},_=(0,n._)("div",{class:"h-4 w-64 bg-primary/10 rounded-md animate-pulse"},null,-1),b=[_],O={class:"mb-4"},U=(0,n._)("div",{class:"text-center"}," По вашему запросу услуги не найдены ",-1),S={key:0,class:"pt-1.5 pb-0.5"},T=(0,n._)("div",{class:"h-4 w-20 bg-primary/10 rounded-md animate-pulse"},null,-1),k=[T],H={key:2,class:"flex gap-4 flex-wrap min-h-[2.375rem] py-3"},x=(0,n.Uk)(" отмена "),Z=(0,n.Uk)(" продолжить ");var C={__name:"search-form",props:{categorySlug:{}},setup(e){var l,a,p,y,_,T;const C=e,{categorySlug:D}=(0,r.BK)(C),z=(0,f.tv)(),{category:$,isLoading:L,isLoaded:P,onGetWhenNotLoaded:W}=(0,u.Z)();(0,n.bv)((()=>{W(D.value,{with:["priority_services","image"]})}));const{services:j,isLoading:F,isLoaded:G,onGet:q,cancel:V,clear:Y}=(0,o.Z)({category:D.value,perPage:20});(0,n.Ah)((()=>{Y()}));const{onCreate:I,isCreated:A,isCreating:J,currentDraftedOrder:K}=(0,s.rJ)(D.value),{isUpdated:Q,isUpdating:N,onUpdate:R}=(0,s.ls)(D.value),B=e=>{z.back()},M=(0,r.iH)((null===(l=K.value)||void 0===l||null===(a=l.services)||void 0===a||null===(p=a[0])||void 0===p?void 0:p.slug)||null),E=(0,r.iH)((null===(y=K.value)||void 0===y||null===(_=y.services)||void 0===_||null===(T=_[0])||void 0===T?void 0:T.name)||"");(0,n.YP)(E,(()=>{var e;const l=(null===$||void 0===$||null===(e=$.priority_services)||void 0===e?void 0:e.find((e=>E.value==e.name)))||j.value.find((e=>E.value==e.name));M.value=l?l.slug:null,g()((()=>{F.value&&V(),q({category:$.slug,with:[],search:E.value})}),200)(),ee.service=null}));const X=e=>{E.value=e.name},ee=(0,r.qj)({}),le=(0,d.ZP)({service:{required:v.C1}},{service:M},{$externalResults:ee}),{service:ae,onGet:ne,isLoading:re}=(0,c.Z)(),te=async e=>{await le.value.$validate()&&(await ne(M.value,{count:["children"]}),K.value?await R({services:[M.value]}).catch((({response:e})=>{if(400==e.status){const{error:l}=null===e||void 0===e?void 0:e.data;"validation"==l.type&&(ee.service=l.fields.services||[],ee.category=l.fields.category||[])}})):await I({category:$.slug,services:[M.value]}).catch((({response:e})=>{if(400==e.status){const{error:l}=null===e||void 0===e?void 0:e.data;"validation"==l.type&&(ee.service=l.fields.services||[],ee.category=l.fields.category||[])}})),z.push({name:"order.update",params:{categorySlug:D.value,serviceSlugs:[M.value],form:ae.value.children_count>0?"select":"work-place"}}))},ie=(0,n.Fl)((()=>L.value||J.value||N.value||re.value));return(e,l)=>{const a=(0,n.up)("c-search"),u=(0,n.up)("c-button");return(0,n.wg)(),(0,n.j4)(i.Z,{onOnSubmit:te},{header:(0,n.w5)((()=>[(0,r.SU)(L)?((0,n.wg)(),(0,n.iD)("div",m,w)):((0,n.wg)(),(0,n.iD)("h1",{key:1,class:(0,t.C_)(["text-3xl text-primary",{"animate-pulse":(0,r.SU)(ie)}])},(0,t.zw)(1==(0,r.SU)($).id?"По какому предмету нужен репетитор?":"Что нужно сделать?"),3)),(0,r.SU)(L)?((0,n.wg)(),(0,n.iD)("div",h,b)):((0,n.wg)(),(0,n.iD)("p",{key:3,class:(0,t.C_)(["text-orange-500",{"animate-pulse":(0,r.SU)(ie)}])},(0,t.zw)((0,r.SU)($).name),3))])),footer:(0,n.w5)((()=>[(0,n.Wm)(u,{scheme:"secondary",type:"button",onClick:B,loading:(0,r.SU)(ie),disabled:(0,r.SU)(ie)},{default:(0,n.w5)((()=>[x])),_:1},8,["loading","disabled"]),(0,n.Wm)(u,{loading:(0,r.SU)(ie),disabled:(0,r.SU)(ie)},{default:(0,n.w5)((()=>[Z])),_:1},8,["loading","disabled"])])),default:(0,n.w5)((()=>{var e,i;return[(0,n._)("div",O,[(0,n.Wm)(a,{class:(0,t.C_)(["w-full sm:w-2/3",{"animate-pulse":(0,r.SU)(ie)}]),disabled:(0,r.SU)(ie),placeholder:(0,r.SU)(L)?"":"Услуга или специалист",modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),loading:!(0,r.SU)(G),items:(0,r.SU)(j),onOnSelectItem:X},{"no-items":(0,n.w5)((()=>[U])),_:1},8,["class","disabled","placeholder","modelValue","loading","items"]),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((0,r.SU)(le).service.$errors,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"text-red-500",key:e.$uid},(0,t.zw)(e.$message),1)))),128))]),(0,r.SU)(L)?((0,n.wg)(),(0,n.iD)("div",S,k)):(0,r.SU)(P)&&(null===(e=(0,r.SU)($).priority_services)||void 0===e?void 0:e.length)>0?((0,n.wg)(),(0,n.iD)("p",{key:1,class:(0,t.C_)({"animate-pulse":(0,r.SU)(ie)})}," Например: ",2)):(0,n.kq)("",!0),(0,r.SU)(P)?((0,n.wg)(),(0,n.iD)("div",H,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)((null===(i=(0,r.SU)($))||void 0===i?void 0:i.priority_services)||[],(e=>((0,n.wg)(),(0,n.j4)(u,{class:"rounded-full py-1 text-sm",outlined:"",loading:(0,r.SU)(ie),disabled:(0,r.SU)(ie),key:e.id,type:"button",onClick:l=>X(e)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.name),1)])),_:2},1032,["loading","disabled","onClick"])))),128))])):(0,n.kq)("",!0)]})),_:1})}}};const D=C;var z=D}}]);
//# sourceMappingURL=order-form-search.30910bd2.js.map